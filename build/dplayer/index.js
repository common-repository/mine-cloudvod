!function(){"use strict";var e=window.wp.element,t=window.wp.blocks,l=(window.wp.i18n,JSON.parse('{"u2":"mine-cloudvod/dplayer"}'));function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},n.apply(this,arguments)}const{useRef:o,useEffect:i}=wp.element,{Flex:a,FlexItem:r,FlexBlock:c,TextControl:d,Button:s}=wp.components,{useState:m}=wp.element;var u=t=>{let{update:l,add:n,remove:o,className:i,time:u,title:p,disabled:v,showNotice:_}=t;const[h,w]=m(u);return(0,e.createElement)(a,{align:"center",className:i},(0,e.createElement)(r,null,(0,e.createElement)(d,{style:{width:"60px"},placeholder:"0",value:h,onChange:e=>w(e),onBlur:()=>{let e=(e=>{let t=e+"";return t?(t=t.replace(/[^\d]/g,""),t=parseInt(t),t):0})(h);l({time:e}),w(e)},autoComplete:"off"})),(0,e.createElement)(c,null,(0,e.createElement)(d,{placeholder:wp.i18n.__("Title","mine-cloudvod"),value:p||"",onChange:e=>l({title:e}),autoComplete:"off"})),(0,e.createElement)(r,null,o&&(0,e.createElement)(s,{icon:"minus",style:{marginBottom:"8px"},label:wp.i18n.__("Remove Marker","mine-cloudvod"),onClick:o}),n&&(0,e.createElement)(s,{icon:"plus-alt",label:wp.i18n.__("Add Marker","mine-cloudvod"),style:{marginBottom:"8px"},onClick:()=>{n(),w("")}})))};const{useState:p}=wp.element;var v=t=>{let{setAttributes:l,attributes:n}=t;const{markers:o}=n;let[i,a]=p({title:"",time:""});return(0,e.createElement)("div",null,(o||[]).sort((function(e,t){return parseInt(e.time)-parseInt(t.time)})).map(((t,n)=>(0,e.createElement)(u,{key:`${n}-${t.time}`,time:t.time,title:t.title,marker:t,update:e=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.indexOf(e),i=o.map(((e,l)=>l!==n?e:{...e,...t}));l({markers:i})}(t,e)},remove:()=>{(e=>{let t=o.indexOf(e);l({markers:o.filter(((e,l)=>l!==t))})})(t)}}))),(0,e.createElement)(u,{time:i.time,title:i.title,update:e=>{a({...i,...e})},add:()=>{i.time&&i.title&&(l({markers:[...o||[],{time:i.time,title:i.title}]}),a({title:"",time:""}))}}))};const{sprintf:_}=wp.i18n,{NavigableMenu:h,MenuItem:w,FormFileUpload:g,MenuGroup:E,ToolbarGroup:b,ToolbarButton:y,Dropdown:k,SVG:f,Rect:C,Path:x,Button:P,TextControl:S,SelectControl:N,Flex:T,FlexItem:R,FlexBlock:B}=wp.components,{MediaUpload:I,MediaUploadCheck:L}=wp.blockEditor,{useSelect:U}=wp.data,{useState:A}=wp.element,D=["text/vtt"],O="subtitles";function M(t){let l,{tracks:n,onEditPress:o}=t;return l=0===n.length?(0,e.createElement)("p",null,wp.i18n.__("Captions are .vtt files that help make your content more accesible to a wider range of users.","mine-cloudvod")):n.map(((t,l)=>(0,e.createElement)("div",{key:l,className:"block-library-video-tracks-editor__track-list-track"},(0,e.createElement)("span",null,t.label," "),(0,e.createElement)(P,{isTertiary:!0,onClick:()=>o(l),"aria-label":_(/* translators: %s: Label of the video text track e.g: "French subtitles" */
wp.i18n.__("Edit %s","mine-cloudvod"),t.label)},wp.i18n.__("Edit","mine-cloudvod"))))),(0,e.createElement)(E,{label:wp.i18n.__("Captions","mine-cloudvod"),className:"block-library-video-tracks-editor__track-list"},l)}function F(t){let{track:l,onChange:n,onClose:o,onRemove:i}=t;const{src:a="",label:r="",lang:c="",kind:d=O}=l,s=a.startsWith("blob:")?"":a.substring(a.lastIndexOf("/")+1);return(0,e.createElement)(h,null,(0,e.createElement)("div",{className:"block-library-video-tracks-editor__single-track-editor"},(0,e.createElement)("span",{className:"block-library-video-tracks-editor__single-track-editor-edit-track-label"},wp.i18n.__("Edit caption track","mine-cloudvod")),(0,e.createElement)("span",null,wp.i18n.__("File","mine-cloudvod"),": ",(0,e.createElement)("b",null,s)),(0,e.createElement)("div",{className:"block-library-video-tracks-editor__single-track-editor-label-language"},(0,e.createElement)(S,{autoFocus:!0,onChange:e=>n({...l,label:e}),label:wp.i18n.__("Caption title","mine-cloudvod"),value:r}),(0,e.createElement)(S,{onChange:e=>n({...l,lang:e}),label:wp.i18n.__("Language tag","mine-cloudvod"),value:c})),(0,e.createElement)("div",{className:"block-library-video-tracks-editor__single-track-editor-buttons-container"},(0,e.createElement)(P,{isSecondary:!0,onClick:()=>{const e={};let t=!1;""===r&&(e.label=wp.i18n.__("English","mine-cloudvod"),t=!0),""===c&&(e.lang="en",t=!0),t&&n({...l,...e}),o()}},wp.i18n.__("Close","mine-cloudvod")),(0,e.createElement)(P,{isDestructive:!0,isLink:!0,onClick:i},wp.i18n.__("Remove caption","mine-cloudvod")))))}function V(t){let{captions:l=[],onChange:n}=t;const o=U((e=>e("core/block-editor").getSettings().mediaUpload),[]),[i,a]=A(null),[r,c]=A();return o?(0,e.createElement)(k,{contentClassName:"block-library-video-tracks-editor",renderToggle:t=>{let{isOpen:l,onToggle:n}=t;return(0,e.createElement)(b,null,(0,e.createElement)(y,{label:wp.i18n.__("Captions","mine-cloudvod"),showTooltip:!0,"aria-expanded":l,"aria-haspopup":"true",onClick:n},wp.i18n.__("Captions","mine-cloudvod")))},renderContent:t=>{let{}=t;return null!==i?(0,e.createElement)(F,{track:l[i],onChange:e=>{const t=[...l];t[i]=e,n(t)},onClose:()=>a(null),onRemove:()=>{n(l.filter(((e,t)=>t!==i))),a(null)}}):(0,e.createElement)("div",null,(0,e.createElement)(h,null,(0,e.createElement)(M,{tracks:l,onEditPress:a}),(0,e.createElement)(E,{className:"block-library-video-tracks-editor__add-tracks-container",label:wp.i18n.__("Add caption languages","mine-cloudvod")},(0,e.createElement)(I,{onSelect:e=>{let{url:t}=e;const o=l.length;n([...l,{src:t}]),a(o)},allowedTypes:D,render:t=>{let{open:l}=t;return(0,e.createElement)(w,{icon:"media",onClick:l},wp.i18n.__("Open Media Library","mine-cloudvod"))}}),(0,e.createElement)(L,null,(0,e.createElement)(g,{onChange:e=>{const t=e.target.files,i=l.length;o({allowedTypes:D,filesList:t,onFileChange:e=>{let[{url:t}]=e;const o=[...l];o[i]||(o[i]={}),o[i]={...l[i],src:t},n(o),a(i)}})},accept:".vtt,text/vtt",render:t=>{let{openFileDialog:l}=t;return(0,e.createElement)(w,{icon:"upload",onClick:()=>{l()}},wp.i18n.__("Upload","mine-cloudvod"))}}))),(0,e.createElement)(E,{className:"block-library-video-tracks-editor__add-tracks-container",label:wp.i18n.__("Add External Subtitle","mine-cloudvod")},(0,e.createElement)("form",{onSubmit:e=>{e.preventDefault();const t=l.length;n([...l,{src:r}]),a(t),c("")}},(0,e.createElement)(T,{style:{width:"100%"}},(0,e.createElement)(B,null,(0,e.createElement)(S,{type:"url",placeholder:wp.i18n.__("External Subtitle Link","mine-cloudvod"),value:r,onChange:e=>c(e)})),(0,e.createElement)(R,null,(0,e.createElement)(P,{isPrimary:!0,style:{marginBottom:"8px"},type:"submit"},wp.i18n.__("Add","mine-cloudvod")))),(0,e.createElement)("p",null,wp.i18n.__("Attention: External subtitles may cause cross-domain issues.","mine-cloudvod"))))))}}):null}const{useEffect:j,useRef:G,useMemo:W,useState:Q}=wp.element,{Spinner:$,Placeholder:z}=wp.components;var H=t=>{let{attributes:l}=t;try{const{source:t,width:n,height:o,cover:i,autoplay:a,live:r}=l,c=W((()=>"dplayer-"+Math.floor(1e6*Math.random())),[t,n,o,i,a,r]),[d,s]=Q(!0);j((()=>{c&&(s(!0),t&&setTimeout((function(){let e=document.getElementById(c);if(!e)return;const l={container:e,autoplay:a,live:r,video:{url:t,pic:i}};new window.McvDPlayer(l)}),2e3))}),[c,n,o,i,a,r]);const m=d?(0,e.createElement)(z,{className:"mine-cloudvod__placeholder is-loading"},(0,e.createElement)($,null)," ",wp.i18n.__("DPlayer is initializing, please wait...","mine-cloudvod")):null;let u={id:c};return u.style={height:o},wp.element.createElement("div",u,m)}catch(e){}};const{ToggleControl:J,PanelBody:q,TextControl:K,Disabled:X}=wp.components,{useState:Y}=wp.element;function Z(t){let{price:l,preview:n,setAttributes:o}=t;const[i,a]=Y(n>0);let r=!1;mcv_addons.actived&&mcv_addons.actived.filter((e=>"previewpurchase"==e.id)).length>0&&(r=!0);const c=(0,e.createElement)(e.Fragment,null,(0,e.createElement)(K,{type:"string",label:wp.i18n.__("Price","mine-cloudvod"),value:l,onChange:e=>o({price:e})}),(0,e.createElement)(J,{label:wp.i18n.__("Preview","mine-cloudvod"),onChange:()=>{i&&o({preview:0}),a(!i)},checked:i}),i&&(0,e.createElement)(K,{type:"number",label:wp.i18n.__("Preview Duration","mine-cloudvod"),value:n,onChange:e=>o({preview:parseInt(e)})}));return(0,e.createElement)(q,{title:wp.i18n.__("Price","mine-cloudvod"),initialOpen:l>0},!r&&(0,e.createElement)("p",null,(0,e.createElement)("a",{href:"admin.php?page=mcv-addons",style:{color:"orange",padding:"5px"}},wp.i18n.__("Please enable the Purchase Video Add-ons first.","mine-cloudvod"))),r?c:(0,e.createElement)(X,null,c))}const{Button:ee,Disabled:te,SelectControl:le,Spinner:ne,ToolbarGroup:oe,ToolbarButton:ie,withNotices:ae,Notice:re,BaseControl:ce,Placeholder:de,ToggleControl:se,PanelBody:me,TextControl:ue,DateTimePicker:pe}=wp.components,{BlockControls:ve,InspectorControls:_e,MediaUpload:he,MediaUploadCheck:we,URLPopover:ge,useBlockProps:Ee}=wp.blockEditor,{useState:be,Fragment:ye,useRef:ke}=wp.element,fe=t=>{let{src:l,onChange:n,onSubmit:o,onClose:i}=t;return(0,e.createElement)(ge,{onClose:i},(0,e.createElement)("form",{className:"block-editor-media-placeholder__url-input-form",onSubmit:o},(0,e.createElement)("input",{"data-cy":"url-input",className:"block-editor-media-placeholder__url-input-field",type:"url","aria-label":wp.i18n.__("URL","mine-cloudvod"),placeholder:wp.i18n.__("Paste an video URL","mine-cloudvod"),onChange:n,value:l}),(0,e.createElement)(ee,{"data-cy":"url-submit",className:"block-editor-media-placeholder__url-input-submit-button",icon:"editor-break",label:wp.i18n.__("Apply","mine-cloudvod"),type:"submit"})))};var Ce=ae((t=>{let{attributes:l,setAttributes:o}=t;const{source:i,width:a,height:r,cover:c,autoplay:d,captions:s,live:m,privt:u,referrer:p,price:_,preview:h}=l,[w,g]=be(!1),[E,b]=be(!1),[y,k]=be(""),f=ke(),C=Ee({ref:f}),x=()=>{b(!1)},P=e=>t=>{o({[e]:t})};function S(e){o({cover:e.url})}const N=(0,e.createElement)(ye,null,(0,e.createElement)(ve,null,(0,e.createElement)(V,{captions:s,onChange:e=>{o({captions:e})}}),(0,e.createElement)(oe,null,(0,e.createElement)(ie,{label:wp.i18n.__("Replace","mine-cloudvod"),showTooltip:!0,"aria-haspopup":"true",onClick:function(){confirm(wp.i18n.__("Replace this video?","mine-cloudvod"))&&(o({videoId:"",oss:"",source:""}),k(""))}},wp.i18n.__("Replace")))),!!i&&(0,e.createElement)(_e,null,(0,e.createElement)(me,{title:wp.i18n.__("Video Markers","mine-cloudvod"),initialOpen:!1},(0,e.createElement)(v,{setAttributes:o,attributes:l})),(0,e.createElement)(Z,{price:_,preview:h,setAttributes:o}),(0,e.createElement)(me,{title:wp.i18n.__("DPlayer Settings","mine-cloudvod")},(0,e.createElement)(se,{label:wp.i18n.__("Private","mine-cloudvod"),onChange:P("privt"),checked:u}),u&&(0,e.createElement)("p",null,wp.i18n.__("This video is only accessible to those who are logged in.","mine-cloudvod")),(0,e.createElement)(se,{label:wp.i18n.__("Autoplay","mine-cloudvod"),onChange:P("autoplay"),checked:d}),(0,e.createElement)(se,{label:wp.i18n.__("Live","mine-cloudvod"),onChange:P("live"),checked:m}),(0,e.createElement)(ue,{type:"string",label:wp.i18n.__("Video URL","mine-cloudvod"),value:i,onChange:e=>o({source:e}),help:wp.i18n.__("Attention, make sure the URL prefix(http or https) is same with the site, otherwise video will not play.","mine-cloudvod")}),(0,e.createElement)(ue,{type:"string",label:wp.i18n.__("Width"),value:void 0!==a?a:"",placeholder:"100%",onChange:e=>o({width:e})}),(0,e.createElement)(ue,{type:"string",label:wp.i18n.__("Height"),value:void 0!==r?r:"",placeholder:"auto or 360px",help:wp.i18n.__("The auto will be adaptive height.","mine-cloudvod"),onChange:e=>o({height:e})}),(0,e.createElement)(we,null,(0,e.createElement)(ce,{className:"editor-video-poster-control"},(0,e.createElement)(ce.VisualLabel,null,(0,e.createElement)("p",null,wp.i18n.__("Cover image","mine-cloudvod"))),(0,e.createElement)("p",null,c?(0,e.createElement)("img",{src:c}):""),(0,e.createElement)(ue,{type:"string",value:c,placeholder:"",onChange:e=>{S({url:e})}}),(0,e.createElement)(he,{title:wp.i18n.__("Select cover image","mine-cloudvod"),onSelect:S,allowedTypes:["image"],render:t=>{let{open:l}=t;return(0,e.createElement)(ee,{isPrimary:!0,onClick:l},c?wp.i18n.__("Replace","mine-cloudvod"):wp.i18n.__("Select","mine-cloudvod"))}}),!!c&&(0,e.createElement)(ee,{onClick:function(){o({cover:""})},isTertiary:!0},wp.i18n.__("Remove","mine-cloudvod")))),(0,e.createElement)(le,{label:wp.i18n.__("Referrer","mine-cloudvod"),value:p,labelPosition:"side",help:wp.i18n.__("If your video doesn't play, try to change this option.","mine-cloudvod"),onChange:e=>{o({referrer:e})},options:[{value:"",label:"Default"},{value:"unsafe-url",label:"Unsafe URL"},{value:"no-referrer",label:"No Referrer"},{value:"no-referrer-when-downgrade",label:"No Referrer When Downgrade"},{value:"origin",label:"Origin Only"},{value:"origin-when-crossorigin",label:"Origin When Cross-origin"}]}))));return i?(w&&(0,e.createElement)(de,{className:"mine-cloudvod__placeholder is-loading"},(0,e.createElement)(ne,null)),(0,e.createElement)(ye,null,N,(0,e.createElement)("figure",n({className:"wp-block-video"},C),(0,e.createElement)(te,null,(0,e.createElement)(H,{attributes:l}))))):(0,e.createElement)("div",C,(0,e.createElement)(de,{label:"DPlayer",instructions:wp.i18n.__("DPlayer is a very useful player, which supports live streaming and recorded video, E.g: mp4 or m3u8 url.","mine-cloudvod")+wp.i18n.__("Attention, make sure the URL prefix(http or https) is same with the site, otherwise video will not play.","mine-cloudvod"),icon:(0,e.createElement)("svg",{version:"1.1",id:"Layer_1",x:"0px",y:"0px",width:"28px",height:"28px",viewBox:"0 0 156 162",enableBackground:"new 0 0 156 162"},(0,e.createElement)("image",{id:"image0",width:"156",height:"162",x:"0",y:"0",href:"https://dplayer.diygod.dev/logo.png"}))},(0,e.createElement)(he,{title:wp.i18n.__("Select or Upload Video","mine-cloudvod"),onSelect:e=>{o({source:e.url}),(e=>{if("string"==typeof e&&e.indexOf(":")>=0){let t=e.split(":");2==t.length&&(e=parseInt(t[1])+60*parseInt(t[0])),3==t.length&&(e=parseInt(t[2])+60*parseInt(t[1])+60*parseInt(t[0])*60)}if((e=parseInt(e)-1)>0){let t=parseInt(e/60),l=e%60;jQuery('input[name="_mcv_lms_lesson_type[_mcv_lesson_duration][minute]"]').val(t),jQuery('input[name="_mcv_lms_lesson_type[_mcv_lesson_duration][second]"]').val(l)}})(e.fileLength)},onClose:()=>{},allowedTypes:"video/*",value:"",render:t=>{let{open:l}=t;return(0,e.createElement)(ee,{isPrimary:!0,onClick:e=>{e.stopPropagation(),l()}},wp.i18n.__("Add/Select Video","mine-cloudvod"))}}),(0,e.createElement)("div",{className:"block-editor-media-placeholder__url-input-container"},(0,e.createElement)(ee,{className:"block-editor-media-placeholder__button",onClick:()=>{b(!0)},isPressed:E,isTertiary:!0},wp.i18n.__("Video URL","mine-cloudvod")),E&&(0,e.createElement)(fe,{src:y,onChange:e=>{k(e.target.value)},onSubmit:e=>{e.preventDefault(),y&&(o({source:y}),x())},onClose:x}))))}));const xe={icon:(0,e.createElement)("svg",{version:"1.1",id:"Layer_1",x:"0px",y:"0px",width:"28px",height:"28px",viewBox:"0 0 156 162",enableBackground:"new 0 0 156 162"},(0,e.createElement)("image",{id:"image0",width:"156",height:"162",x:"0",y:"0",href:"https://dplayer.diygod.dev/logo.png"})),edit:Ce,save:function(){return null}};(0,t.registerBlockType)(l.u2,xe)}();