!function(){"use strict";var e=window.wp.blocks,t=(window.wp.i18n,JSON.parse('{"u2":"mine-cloudvod/course-list","TN":"Course List","qv":"editor-table","WL":"Show some course data"}')),l=window.wp.element,a=window.wp.components,n=window.wp.blockEditor,r=window.wp.primitives,o=(0,l.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(r.Path,{d:"M14.5 13.8c-1.1 0-2.1.7-2.4 1.8H4V17h8.1c.3 1 1.3 1.8 2.4 1.8s2.1-.7 2.4-1.8H20v-1.5h-3.1c-.3-1-1.3-1.7-2.4-1.7zM11.9 7c-.3-1-1.3-1.8-2.4-1.8S7.4 6 7.1 7H4v1.5h3.1c.3 1 1.3 1.8 2.4 1.8s2.1-.7 2.4-1.8H20V7h-8.1z"}));function c(e){let{attributes:t,setAttributes:n}=e;return(0,l.createElement)(a.Dropdown,{contentClassName:"block-library-query-toolbar__popover",renderToggle:e=>{let{isOpen:t,onToggle:n}=e;return(0,l.createElement)(a.ToolbarGroup,null,(0,l.createElement)(a.ToolbarButton,{icon:o,label:wp.i18n.__("Display settings"),showTooltip:!0,"aria-haspopup":"true","aria-expanded":t,onClick:n}))},renderContent:e=>{let{}=e;return(0,l.createElement)("div",null,(0,l.createElement)(a.__experimentalNumberControl,{label:wp.i18n.__("Number of rows","mine-cloudvod"),labelPosition:"edge",type:"number",value:t.rows,onChange:e=>n({rows:null!=e?e:1}),__unstableInputWidth:"60px",min:1,max:10,step:"1",isDragEnabled:!1}),(0,l.createElement)(a.__experimentalNumberControl,{label:wp.i18n.__("Number of columns","mine-cloudvod"),labelPosition:"edge",type:"number",value:t.columns,onChange:e=>n({columns:null!=e?e:4}),__unstableInputWidth:"60px",min:1,max:6,step:"1",isDragEnabled:!1}))}})}const{useState:s,Fragment:i,useRef:u}=wp.element,m={edit:(0,a.withNotices)((e=>{let{attributes:r,setAttributes:o}=e;const{categories:m,title:d,tags:p,morelink:w,moretext:b,rows:v,columns:_,template:E}=r,h=u(),g=(0,n.useBlockProps)({ref:h}),[C,N]=s([]);let f=u(!0);(0,l.useEffect)((()=>(wp.apiFetch({path:wp.url.addQueryArgs("/wp/v2/course-category",{per_page:-1,orderby:"count",order:"desc",_fields:["id","name","count"],hide_empty:!0})}).then((e=>{f&&N(e.map((e=>({value:e.id,label:e.name}))))})).catch((()=>{f&&N([])})),()=>{f=!1})),[]);const[k,x]=s([]);let y=u(!0);(0,l.useEffect)((()=>(wp.apiFetch({path:wp.url.addQueryArgs("/wp/v2/course-tag",{per_page:-1,orderby:"count",order:"desc",_fields:["id","name","count"],hide_empty:!0})}).then((e=>{y&&x(e.map((e=>({value:e.id,label:e.name}))))})).catch((()=>{y&&x([])})),()=>{f=!1})),[]);const[T,L]=s([]),[S,W]=s(!0);(0,l.useEffect)((()=>{W(!0);let e={};m&&(e={"course-category":m});let t={};p&&(t={"course-tag":p});let l=v*_;wp.apiFetch({path:wp.url.addQueryArgs("/wp/v2/mcv_course",{page:1,per_page:null!=l?l:4,...e,...t})}).then((e=>{W(!1),L(e)})).catch((()=>{L([])}))}),[m,p,v,_]);const A=(0,l.createElement)(i,null,(0,l.createElement)(n.BlockControls,null,(0,l.createElement)(c,{attributes:r,setAttributes:o})),(0,l.createElement)(n.InspectorControls,null,(0,l.createElement)(a.PanelBody,{title:t.TN+wp.i18n.__("Settings","mine-cloudvod")},(0,l.createElement)(a.TextControl,{type:"string",label:wp.i18n.__("Title","mine-cloudvod"),value:d,onChange:e=>o({title:e})}),!E&&(0,l.createElement)(a.TextControl,{type:"string",label:wp.i18n.__("More Link","mine-cloudvod"),value:w,onChange:e=>o({morelink:e})}),!E&&(0,l.createElement)(a.TextControl,{type:"string",label:wp.i18n.__("More Text","mine-cloudvod"),value:b,onChange:e=>o({moretext:e})}),(0,l.createElement)(a.ComboboxControl,{label:wp.i18n.__("Categories","mine-cloudvod"),value:m,onChange:e=>{o({categories:e})},options:C,onInputChange:e=>N(options.filter((t=>t.label.toLowerCase().startsWith(e.toLowerCase()))))}),(0,l.createElement)(a.ComboboxControl,{label:wp.i18n.__("Tags","mine-cloudvod"),value:p,onChange:e=>{o({tags:e})},options:k,onInputChange:e=>x(options.filter((t=>t.label.toLowerCase().startsWith(e.toLowerCase()))))}))));let B=0;return(0,l.createElement)("div",g,A,S?(0,l.createElement)(a.Placeholder,{className:"mine-cloudvod__placeholder is-loading",label:t.TN,instructions:t.WL,icon:t.qv},(0,l.createElement)(a.Spinner,null)):(0,l.createElement)(a.Disabled,null,(0,l.createElement)("div",{className:"mcv-block"},(0,l.createElement)("div",{className:"block-container"},d&&(0,l.createElement)("div",{className:"result"},(0,l.createElement)("h2",{className:"result__title"},d),!E&&w&&b&&(0,l.createElement)("a",{href:w,className:"result__desc"},b),E&&(0,l.createElement)("span",{className:"result__desc"},"共找到",(0,l.createElement)("em",{className:"result__count"},"xx"),"个结果")),(0,l.createElement)("div",{className:"course-list col"+_},T.map((e=>{if(B++,!(B>v*_))return(0,l.createElement)("div",{key:"k_"+e.id},(0,l.createElement)("section",{className:"course-card-expo-wrapper"},(0,l.createElement)("a",{className:"kc-course-card js-report-link kc-list-course-card kc-course-card-column",href:"http://localhost:8888/mcv_course/%e8%bd%af%e4%bb%b6%e6%b5%8b%e8%af%95/"},(0,l.createElement)("div",{className:"kc-course-card-cover"}),(0,l.createElement)("div",{className:"kc-course-card-content"},(0,l.createElement)("h3",{className:"kc-course-card-name"},e.title.rendered),(0,l.createElement)("div",{className:"kc-course-card-footer"},(0,l.createElement)("div",{className:"kc-coursecard-footer-left"},(0,l.createElement)("span",{className:"kc-course-card-price"},"价格"),(0,l.createElement)("span",{className:"kc-course-card-student-apply-num---KvJiqW"},"x人学习")))))))})))))))})),save:function(){return null}};(0,e.registerBlockType)(t.u2,m)}();