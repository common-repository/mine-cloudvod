(function(){"use strict";var __webpack_modules__={7136:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9307),_wordpress_element__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__),_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6989),_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_1__),_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5736),_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__),_wordpress_components__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5609),_wordpress_components__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__);__webpack_exports__.Z=_ref=>{let{isOpen:isOpen,setOpen:setOpen,redirect_to:redirect_to}=_ref;if(window?.mcv_uc_general?.loginselector&&jQuery(window.mcv_uc_general.loginselector).length>0)return void jQuery(window.mcv_uc_general.loginselector)[0].click();redirect_to||(redirect_to="/");const closeModal=()=>setOpen(!1),[initialTabName,setInitialTabName]=(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(""),[username,setUsername]=(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(""),[email,setEmail]=(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(""),[password,setPassword]=(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(""),[isBusy,setIsBusy]=(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[loginType,setLoginType]=(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useState)("form");function handleLogin(e){e.preventDefault(),setIsBusy(!0),_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_1___default()({path:"/mine-cloudvod/v1/member/login",method:"POST",data:{log:username,pwd:password}}).then((e=>{e?.success&&window.location.reload()})).catch((e=>{setIsBusy(!1),layer.msg(e.message)}))}function handleReg(e){e.preventDefault(),setIsBusy(!0),_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_1___default()({path:"/mine-cloudvod/v1/member/reg",method:"POST",data:{log:username,pwd:password,email:email}}).then((e=>{e?.success&&(layer.msg((0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Registered successfully, please log in.","mine-cloudvod")),setLoginType("form"))})).catch((e=>{setIsBusy(!1),layer.msg(e.message)}))}let tabs=window.mcv_uc_general.uc_login3;return isOpen&&(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Modal,{title:"reg"==loginType?(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Create your account","mine-cloudvod"):(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("User Login","mine-cloudvod"),onRequestClose:closeModal,focusOnMount:!1,shouldCloseOnClickOutside:!0,__experimentalHideHeader:!0,className:"mcv-login-modal",initialTabName:initialTabName},(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.TabPanel,{tabs:tabs,onSelect:e=>{setLoginType("default"==e?"form":e)},children:tab=>"default"!=tab?.name?(tab?.script&&setTimeout((function(){eval(tab.script)}),100),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)("div",{id:"login_container"})):"form"==loginType?(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)("div",{className:"mcv-uc-login"},(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.TextControl,{placeholder:(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Username or Email Address","mine-cloudvod"),onChange:e=>{setUsername(e)},value:username,style:{fontSize:"14px",lineHeight:"1.33333333",width:"100%",borderWidth:"0.0625rem",padding:"0.1875rem 0.3125rem",margin:"0 6px 16px 0",minHeight:"40px",maxHeight:"none",borderRadius:"4px"}}),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.TextControl,{placeholder:(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Password","mine-cloudvod"),onChange:e=>{setPassword(e)},value:password,type:"password",style:{fontSize:"14px",lineHeight:"1.33333333",width:"100%",borderWidth:"0.0625rem",padding:"0.1875rem 0.3125rem",margin:"0 6px 16px 0",minHeight:"40px",maxHeight:"none",borderRadius:"4px"}}),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Flex,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.FlexItem,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Button,{variant:"primary",onClick:handleLogin,isBusy:isBusy},(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Log In","mine-cloudvod"))),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.FlexItem,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Button,{variant:"link",onClick:()=>{window.mcv_uc_general.regurl?location.href=window.mcv_uc_general.regurl:setLoginType("reg")},isBusy:!1},(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Register","mine-cloudvod"))))):"reg"==loginType?(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)("div",{className:"mcv-uc-reg"},(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.TextControl,{placeholder:(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Username","mine-cloudvod"),onChange:e=>{setUsername(e)},value:username,style:{fontSize:"14px",lineHeight:"1.33333333",width:"100%",borderWidth:"0.0625rem",padding:"0.1875rem 0.3125rem",margin:"0 6px 16px 0",minHeight:"40px",maxHeight:"none",borderRadius:"4px"}}),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.TextControl,{placeholder:(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Email Address","mine-cloudvod"),onChange:e=>{setEmail(e)},value:email,style:{fontSize:"14px",lineHeight:"1.33333333",width:"100%",borderWidth:"0.0625rem",padding:"0.1875rem 0.3125rem",margin:"0 6px 16px 0",minHeight:"40px",maxHeight:"none",borderRadius:"4px"}}),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.TextControl,{placeholder:(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Password","mine-cloudvod"),onChange:e=>{setPassword(e)},value:password,type:"password",style:{fontSize:"14px",lineHeight:"1.33333333",width:"100%",borderWidth:"0.0625rem",padding:"0.1875rem 0.3125rem",margin:"0 6px 16px 0",minHeight:"40px",maxHeight:"none",borderRadius:"4px"}}),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Flex,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.FlexItem,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Button,{variant:"primary",onClick:handleReg,isBusy:isBusy},(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Sign up","mine-cloudvod"))),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.FlexItem,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_components__WEBPACK_IMPORTED_MODULE_3__.Button,{variant:"link",onClick:()=>{setLoginType("form")},isBusy:!1},(0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__.__)("Already have an account? Log in","mine-cloudvod"))))):void 0}))}},6989:function(e){e.exports=window.wp.apiFetch},5609:function(e){e.exports=window.wp.components},7701:function(e){e.exports=window.wp.domReady},9307:function(e){e.exports=window.wp.element},5736:function(e){e.exports=window.wp.i18n}},__webpack_module_cache__={};function __webpack_require__(e){var _=__webpack_module_cache__[e];if(void 0!==_)return _.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=function(e){var _=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(_,{a:_}),_},__webpack_require__.d=function(e,_){for(var r in _)__webpack_require__.o(_,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:_[r]})},__webpack_require__.o=function(e,_){return Object.prototype.hasOwnProperty.call(e,_)};var __webpack_exports__={};!function(){var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9307),_wordpress_element__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__),_wordpress_dom_ready__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7701),_wordpress_dom_ready__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_wordpress_dom_ready__WEBPACK_IMPORTED_MODULE_1__),_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6989),_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_2__),_user_login__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7136);const{createRoot:createRoot,render:render,useState:useState,useEffect:useEffect,useRef:useRef}=wp.element,PurchaseBody=()=>{const[curPay,setCurPay]=useState(""),[isRes,setRes]=useState(!1),[isShow,_setShow]=useState(!1),isShowRef=useRef(isShow);function setShow(e){isShowRef.current=e,_setShow(e)}let isInt=0;function getQueryString(e){var _=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(_);return null!=r?unescape(r[2]):null}useEffect((()=>{let e=getQueryString("payment");e||(e=jQuery(".purchase-price--channel.selected").data("id")),setCurPay(e),jQuery(".purchase-price--channel").on("click",(function(){jQuery(".purchase-price--channel").removeClass("selected"),jQuery(this).addClass("selected");let e=jQuery(".purchase-price--channel.selected").data("id");setCurPay(e)})),0==isInt&&(isInt=setInterval(checkStatus,2e3))}),[]);const checkAndPay=()=>{window.mcv_global?.islogin?"0"==jQuery("#mcv_orderid").val()?jQuery.get(location.href,(function(e){jQuery("#mcv-purchase-body").html(jQuery("#mcv-purchase-body",e).html()),preHandler()})):preHandler():setShow(!0)},preHandler=()=>{let e=curPay;if(curPay||(e=getQueryString("payment")),e&&mcv_course_data.payments.filter((_=>_.id==e)).length>0){window.layer.load(1,{shade:[.3,"#fff"]});let _={pay:e,orderid:jQuery("#mcv_orderid").val(),code:getQueryString("code")};_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_2___default()({path:"mine-cloudvod/v1/member/order/create",method:"POST",data:_}).then((e=>{handleCAPResult(e)})).catch((e=>{layer.closeAll(),layer.msg(e.message),"nologin"==e.code&&setShow(!0)}))}else layer.msg("请选择一个支付方式")},handleCAPResult=res=>{if(layer.closeAll(),"face2face"==res?.mcv_method)openQRBox(res.alipay,res.qrimg,"支付宝扫码支付 "+res.amount+" 元","支付宝");else if("pc"==res?.mcv_method||"mobile"==res?.mcv_method){layer.open({type:1,title:!1,area:["300px","420px"],content:'<div id="swal2-content" style="display: block;width:300px;text-align: center;"><div style=""> <h5 style="padding: 0;margin-top: 1.8em;margin-bottom: 0;"> 订单已生成 </h5> <div style="font-size: 16px;margin: 10px auto;">请在打开的链接中完成支付</div> <div align="center" class="qrcode"> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="150px" height="150px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve" style="margin: auto;position: absolute;top: 0;bottom: 0;left: 0;right: 0;height: 30%;"><path opacity="0.2" fill="#FF6700" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"></path><path fill="#FF6700" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z" transform="rotate(42.1171 20 20)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="2.5s" repeatCount="indefinite"></animateTransform></path></svg> </div> <div id="mcv_alipay_tips" style="width: 100%;background: #33465a;color: #f2f2f2;padding: 16px 0px;text-align: center;font-size: 14px;margin-top: 20px;background: #00a7ef;position: absolute;bottom:0;"> 请使用支付宝扫一扫<br>请在２小时内完成支付<br> </div> </div></div>'});var form=document.createElement("form");form.action="https://openapi.alipay.com/gateway.do?charset=utf-8",form.method="POST",Object.keys(res).map((e=>{if("id"!=e&&"mcv_method"!=e&&"scripts"!=e&&"amount"!=e){let _=document.createElement("input");_.type="hidden",_.name=e,_.value=decodeURIComponent(res[e]),form.appendChild(_)}})),document.body.appendChild(form),form.submit()}else res?.id&&res?.scripts&&eval(res.scripts)},openQRBox=(e,_,r,t,n)=>{n||(n="#00a7ef"),layer.open({type:1,title:!1,area:["300px","420px"],content:'<div id="swal2-content" style="display: block;width:300px;text-align: center;"><div style=""> <h5 style="padding: 0;margin-top: 1.8em;margin-bottom: 0;"> <img src="'+e+'" style="display: inline-block;margin: 0;padding: 0;width: 120px;text-align: center;"> </h5> <div style="font-size: 16px;margin: 10px auto;">'+r+'</div> <div align="center" class="qrcode"> <img style="width: 200px;height: 200px;" src="'+_+'" id="buytimebug_qrcode"> </div> <div id="mcv_alipay_tips" style="width: 100%;color: #f2f2f2;padding: 16px 0px;text-align: center;font-size: 14px;margin-top: 20px;background: '+n+';position: absolute;bottom:0;"> 请使用'+t+"扫一扫<br>请在２小时内完成支付<br> </div> </div></div>"})},checkStatus=()=>{_wordpress_api_fetch__WEBPACK_IMPORTED_MODULE_2___default()({path:"mine-cloudvod/v1/member/order/checkQRStatus",method:"POST",data:{order_id:jQuery("#mcv_orderid").val()}}).then((e=>{if("paying"==e.status){let _=document.getElementById("mcv_alipay_tips");_&&(_.style.background="#edffcc",_.style.color="gray",_.innerHTML='<span style="color:#F60;">'+e.user+"</span> 已创建订单<br>请在手机支付宝上完成付款<br>")}if("payed"==e.status){clearInterval(isInt);let _=document.getElementById("mcv_alipay_tips");_&&(_.style.background="#edffcc",_.style.color="gray",_.innerHTML='<span style="color:#F60;">恭喜您完成订单支付</span><br>正在为您跳转到支付前页面...<br>'),setTimeout((function(){location.href=e.url}),2e3)}})).catch((e=>{console.log(e)}))};return useEffect((()=>{let e=getQueryString("code");"wechat"==getQueryString("payment")&&e&&checkAndPay()}),[]),(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)("button",{className:"im-btn purchase-bottom-btn btn-default btn-m",onClick:checkAndPay},"确认支付"),isShow&&(0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(_user_login__WEBPACK_IMPORTED_MODULE_3__.Z,{isOpen:isShow,setOpen:setShow,redirect_to:location.href}))};_wordpress_dom_ready__WEBPACK_IMPORTED_MODULE_1___default()((function(){document.getElementById("mcv-purchase-btn")&&(createRoot?createRoot(document.getElementById("mcv-purchase-btn")).render((0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(PurchaseBody,null)):render((0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createElement)(PurchaseBody,null),document.getElementById("mcv-purchase-btn")),jQuery((function(e){if("0"!=e("#mcv_orderid").val()&&location.href.indexOf("orderid=")<0){let _=location.href.split("?");_=_[0]+"?orderid="+e("#mcv_orderid").val(),window.history.pushState({},"",_)}})))}))}()})();